# http协议那些事
> 这小节内容主要梳理下HTTP协议的组成及其使用方式，主要含以下几部分：
- [浏览器请求的流程](#1)
- [什么是HTTP协议](#2)
- [HTTP的工作过程](#3)
- [请求与响应](#4)
- [HTTP缓存机制](#5)
- [HTTPS协议分析](#6)
- [HTTP2协议分析](#7)
- [了解HTTP3](#8)
### 浏览器请求的流程 <a id="1"></a>
- 解析域名
- 浏览器发送HTTP请求
- 服务器处理请求
- 服务器返回Html的响应
- 浏览器处理Html页面
- 继续请求其他资源，如图片

### 什么是HTTP协议 <a id="2"></a>

HTTP协议是超文本传输协议，从www浏览器传输到本地浏览器的一种传输协议，网站基于HTTP协议的；http协议是由从客户机到服务机的请求和从服务器到客户机的响应进行约束和规范。

1. 了解TCP/IP协议栈：应用层，描述层，会话层，传输层，网路层，数据链路层，物理层：
    -应用层，为用户提供所需要的各种服务，如：http，ftp，dns，等
    - 传输层：
        + 为应用层实体提供端到端的通信功能，保证数据包的顺序传送及数据的完整性
        + 该层定义了两个主要的协议：TCP，UDP
    - 网路层，主要解决主机到主机的通信问题。ip协议是最为重要的协议
    - 网路接口层：
        + 数据链路层和物理层的合并
        +  负责监视数据在主机和网路之间的交换

2. http在 TCP/IP协议栈的位置
> 处于应用层，在TCP之上，包含子模块 TSL，SSL；目前普遍应用版本是v1.1，正在向v2迁移，http的默认端口80，https默认端口443.

### HTTP的工作过程 <a id="3"></a>
一次http的操作称为一次事物，其工作过程可分为四步：
- C-S建立链接
- C 发送一个请求和S，格式为：统一资源标识符，协议版本号，后边是
mime信息包括请求修饰符，C的信息和可能内容
- S收到请求后，给予响应信息，格式为一个状态行，包括信息的协议版本号，一个成功或错误的代码，后边是mime信息包括服务器信息，实体信息和可能内容
- C收到响应后显示在浏览器上，然后断开链接
- 如果以上过程中的某一步出现错误，那么产生的错误信息将返回到客户端

### 请求与响应 <a id="4"></a>
1. 组成结构
- 请求，请求行，消息报头，请求正文
- 响应，状态行，休息报头，响应正文
- 请求行组成：请求方法 协议版本
- 状态行组成： 服务器http协议的版本 状态码 状态码文字描述


###  HTTP缓存机制 <a id="5"></a>
缓存会根据请求保存输出内容的副本，例如html页面，图片，文件，当下一个请求到来的时候，如果是相同的url，缓存直接使用副本响应访问请求，而不是向服务器再次发送请求；因此可以减少响应延迟，减少网络带宽消耗

1. 浏览器缓存机制
- 是否缓存 cache-control,expires
- 查缓存时间 是否过期
- Etag
- Last-Modified

2. 了解两种缓存策略
- 强制缓存与对比缓存
    + 强制缓存，服务器通知浏览器一个缓存时间，缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略
    + 比较缓存，将缓存信息的Etag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时浏览器直接用缓存
- Etag/if-None-Match策略
- Last-Modified/if-Modified-since策略

### HTTPS协议分析 <a id="6"></a>
1. https协议的安全性由SSL实现，当前使用的TLS协议1.2版本包含了四个核心子协议：握手协议，秘钥配置切换协议，应用数据协议及报警协议
2. 数字证书：是互联网通信中标识双方身份信息的数字文件，由CA（certification authority）签发
3. HTTPS协议，SSL协议，TLS协议，握手协议的关系
- HTTPS是 http over SSL，可以理解为基于SSL的http协议。
- SSL协议是一种记录协议，扩展性良好，可方便添加子协议，而握手协议便是SSL的一个子协议
- TLS是SSL的后续版本文中所涉及的SSL协议版本默认是TLS1.2版本

### HTTP2协议分析 <a id="7"></a>

1. HTTP2的特点：
    - 使用二进制格式传输，更高效，更紧凑
    - 对报头压缩，降低开销
    - 多路复用，一个链接实现并行请求
    - 服务器主动推送，减少请求延迟
    - 默认使用加密
2. HTTP2的伪头字段
    - 伪头字段是http2内置的几个特殊的以“：”开始的key，用于替代http/1.x中响应行中的信息，比如请求方法，状态码等
        + :method
        + :scheme
        + :path
        + :authority
        + :status

### 了解HTTP3 <a id="8"></a>

- HTTP-over-QUIC被更名为HTTP3
- QUIC协议是：QUICK UDP Internet Connection
- HTTP3和http1与http2没有直接关系
- HTTP3将是一个全新的web协议
- HTTP3目前在制定测试阶段